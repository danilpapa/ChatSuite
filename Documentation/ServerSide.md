# ChatServer – Серверная часть

Простой backend для чата в реальном времени, реализованный на Swift с использованием асинхронного фреймворка Vapor.

## Технологический стек

| Компонент              | Технология / Библиотека                            | Описание |
|-----------------------|-----------------------------------------------------|----------|
| **Фреймворк**         | [Vapor](https://vapor.codes)                        | Асинхронный веб-фреймворк на Swift (Server-Side Swift) |
| **ORM / База данных** | [Fluent](https://docs.vapor.codes/fluent/overview/) | ORM для работы с PostgreSQL |
| **База данных**       | PostgreSQL                                          | Хранение пользователей, друзей, запросов на дружбу и т.д. |
| **Подключение к БД**  | PostgresKit + PostgresNIO                           | Асинхронное соединение с PostgreSQL |
| **WebSocket**         | Vapor WebSocket + NIOSSL                            | Реал-тайм чат и уведомления |
| **TLS**               | NIOSSL                                              | Шифрование соединения |
| **Криптография**      | CryptoKit                                           | Обмен публичными ключами для E2E-шифрования |
| **Аутентификация**    | Google Sign-In (через Firebase token)               | Логин по email + проверка Firebase токена |
| **Уведомления**       | Отдельный WebSocket-канал (`/connect`)              | Push-уведомления о входящем чате |
| **Миграции**          | Fluent Migrations                                   | На все модели (User, UserFriends, MateRequests, RecentChats и т.д.) |

## Основные возможности

- Регистрация/логин через Google (Firebase token)
- Поиск пользователей по префиксу имени
- Управление друзьями и запросами на дружбу
- Реал-тайм чат через WebSocket с поддержкой 1-на-1 соединений
- Уведомления о новом входящем чате через отдельный WebSocket
- Поддержка TLS
- Автоматическая миграция базы данных при старте

## Запуск

```bash
make server
```

## Скрипты для разработки

```bash
# Запуск PostgreSQL в Docker
make db
# Запуск сервера
make server
# Запуск сервера в фоновом режиме
make bg
```

Сервер запускается на `https://localhost:8443` (требуются валидные сертификаты в `Resources/TLS/`).